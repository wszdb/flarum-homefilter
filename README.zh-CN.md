# Flarum Home Filter - 首页帖子智能过滤插件

[English](README.md) | 简体中文

一个智能的 Flarum 首页帖子过滤插件，支持按**标题**或**标签**过滤关键词，灵活控制特定类型帖子的显示数量。

## ✨ 功能特性

### 🎯 双模式过滤
- **标题过滤模式**：根据帖子标题中的关键词进行过滤
- **标签过滤模式**：根据帖子标签中的关键词进行过滤

### 🔧 灵活配置
- 自定义过滤关键词（支持多个关键词，逗号分隔）
- 设置关键词帖子的显示数量限制
- 在后台轻松切换过滤模式

### 🚀 智能补充
- 自动补充非关键词帖子，确保首页显示数量完整
- 避免因过滤导致首页帖子数量不足

## 📦 安装

通过 Composer 安装：

```bash
composer require wszdb/flarum-homefilter
```

安装后在 Flarum 后台启用插件。

## ⚙️ 配置说明

进入 Flarum 后台 → 扩展 → Home Filter，可以看到以下配置选项：

### 1. 过滤关键词
输入需要过滤的关键词，多个关键词用英文逗号分隔。

**示例：**
```
广告,推广,招聘
```

### 2. 过滤模式
选择过滤方式：

- **标题过滤**：检查帖子标题是否包含关键词
- **标签过滤**：检查帖子标签是否包含关键词（需要安装 flarum/tags 扩展）

### 3. 关键词帖子显示数量
设置包含关键词的帖子在首页最多显示几个。

- 设置为 `3`：最多显示 3 个包含关键词的帖子
- 设置为 `0`：完全隐藏包含关键词的帖子

## 💡 使用场景

### 场景 1：限制广告帖子
```
关键词：广告,推广,营销
过滤模式：标题过滤
显示数量：2
```
效果：首页最多显示 2 个标题包含"广告"、"推广"或"营销"的帖子。

### 场景 2：控制特定分类
```
关键词：General,闲聊
过滤模式：标签过滤
显示数量：5
```
效果：首页最多显示 5 个带有"General"或"闲聊"标签的帖子。

### 场景 3：完全隐藏某类内容
```
关键词：spam,垃圾
过滤模式：标题过滤
显示数量：0
```
效果：完全不显示标题包含"spam"或"垃圾"的帖子。

## 🔍 工作原理

1. **过滤阶段**：检查首页帖子列表，根据选择的模式（标题/标签）和关键词进行匹配
2. **限制阶段**：保留指定数量的关键词帖子，过滤掉超出限制的部分
3. **补充阶段**：如果过滤后帖子数量不足，自动从数据库查询补充非关键词帖子
4. **精确控制**：确保最终显示的帖子数量与首页配置一致

## 📊 性能说明

- **标题过滤模式**：性能与原版 Flarum 完全一致
- **标签过滤模式**：额外增加 1-2 次数据库查询，使用了优化的 JOIN 查询
- **适用范围**：适合绝大多数规模的论坛（日访问量 < 10000）

## 🛠️ 技术细节

### 标签过滤实现
使用数据库查询直接获取帖子标签关系：

```php
$db->table('discussion_tag')
    ->join('tags', 'discussion_tag.tag_id', '=', 'tags.id')
    ->whereIn('discussion_tag.discussion_id', $discussionIds)
    ->select('discussion_tag.discussion_id', 'tags.name')
    ->get();
```

### 依赖要求
- Flarum ^1.8.0
- 标签过滤模式需要：flarum/tags 扩展

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

MIT License

## 🔗 相关链接

- [GitHub 仓库](https://github.com/wszdb/flarum-homefilter)
- [Flarum 官网](https://flarum.org)
- [Flarum 中文社区](https://discuss.flarum.org.cn)

## 💬 支持

如有问题或建议，请在 GitHub 提交 Issue。

---

本插件使用 [AiPy](https://www.aipyaipy.com/) 全自动开发完成，邀请码：XOFS.
